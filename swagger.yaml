openapi: 3.1.0
info:
  title: Private Dining Service
  version: "1"
  description: |
    Allows users to create and manage restaurants, as well as create reservations for rooms at those restaurants.

# --- Paths (Endpoints) ---
paths:
  /v1/reservation:
    post:
      summary: Create a new reservation.
      description: |
        Creates a reservation for a specific room at a specific time. The **user** is inferred from the session/authentication token.
        The reservation end time is calculated automatically based on business rules.
      operationId: createReservation
      tags:
        - Reservation
      requestBody:
        description: The details required to book a room.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReservationRequest'
      responses:
        '201':
          description: Reservation successfully created.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Reservation'
        '400':
          description: Invalid input or data (e.g., room not found, invalid dates).
        '409':
          description: Conflict, the room is already booked for the specified time slot.
        '401':
          description: Unauthorized. User session not valid.

  /v1/reservation/{id}:
    patch:
      summary: Update the state of a specific reservation.
      description: |
        Allows the authenticated user to update the state of a reservation they own, typically to **CANCELLED**.
        The reservation is identified by its ID in the path.
      operationId: updateReservationState
      tags:
        - Reservation
      parameters:
        - name: id
          in: path
          required: true
          description: The unique identifier of the reservation to update.
          schema:
            type: integer
            format: int64
          example: 8002
      requestBody:
        description: The new state (status) to assign to the reservation.
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ReservationUpdate'
      responses:
        '200':
          description: Reservation state successfully updated. Returns the updated reservation object.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Reservation'
        '400':
          description: Invalid input or an attempt was made to transition to an invalid state.
        '401':
          description: Unauthorized. User session not valid.
        '403':
          description: Forbidden. User is not authorized to modify this reservation.
        '404':
          description: Reservation not found.

  /v1/availabilities:
    get:
      summary: Search for room availability by restaurant, date, and guest count.
      description: |
        Retrieves the bookable time slots for rooms at a specific restaurant on a given date that can accommodate the guest count.
      operationId: searchAvailabilities
      tags:
        - Availability
      parameters:
        - name: date
          in: query
          required: true
          description: The specific date to check availability (YYYY-MM-DD).
          schema:
            type: string
            format: date
            example: '2025-12-10'
        - name: numberOfGuests
          in: query
          required: true
          description: The minimum number of guests the room must accommodate.
          schema:
            type: integer
            format: int32
            minimum: 1
            example: 10
        - name: restaurantId
          in: query
          required: true
          description: The unique identifier of the restaurant to check.
          schema:
            type: integer
            format: int64
            example: 101
      responses:
        '200':
          description: Availability data successfully retrieved.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/RestaurantAvailability'
        '400':
          description: Invalid input (e.g., date format incorrect, guest count too low).
        '404':
          description: Restaurant not found.

# --- Components (Reusable Definitions) ---
components:
  schemas:
    # --- Single Reference Schema (Reused for User, Room, and Restaurant) ---
    Reference:
      description: A minimal object reference (id and name) used for displaying related resources.
      type: object
      required:
        - id
        - name
      properties:
        id:
          type: integer
          format: int64
          description: The unique identifier of the referenced resource.
          example: 1205
        name:
          type: string
          description: The display name of the referenced resource.
          example: "Name of the resource (e.g. room, restaurant, person)"

    # --- Enum Schemas ---
    ReservationState:
      type: string
      description: The current status of the reservation.
      enum:
        - ACCEPTED # Confirmed by the restaurant
        - CANCELLED # Canceled by user or restaurant

    # --- Request Schemas ---
    ReservationRequest:
      type: object
      description: The required data to create a new reservation.
      required:
        - roomId
        - numberOfGuests
        - start
      properties:
        roomId:
          type: integer
          format: int64
          description: The unique ID of the room being reserved.
          example: 45
        numberOfGuests:
          type: integer
          format: int32
          minimum: 1
          description: The number of guests for the reservation.
          example: 10
        start:
          type: string
          format: date-time
          description: The instant the reservation is scheduled to begin (ISO 8601).
          example: '2025-12-10T19:00:00Z'

    ReservationUpdate:
      type: object
      description: Schema for updating a reservation. Currently only allows state updates.
      properties:
        state:
          $ref: '#/components/schemas/ReservationState'
          description: The desired new state for the reservation (ACCEPTED or CANCELLED).
      required:
        - state

    # --- Response Schemas (The main object model) ---
    Reservation:
      type: object
      description: Details for a specific private dining room reservation.
      required:
        - id
        - user
        - room
        - restaurant
        - state
        - start
        - end
        - numberOfGuests
      properties:
        id:
          type: integer
          format: int64
          description: The unique identifier for the reservation.
          example: 8002
        user:
          $ref: '#/components/schemas/Reference'
          description: The user who created the reservation.
        room:
          $ref: '#/components/schemas/Reference'
          description: The room that was reserved.
        restaurant:
          $ref: '#/components/schemas/Reference'
          description: The restaurant where the room is located.
        state:
          $ref: '#/components/schemas/ReservationState'
        start:
          type: string
          format: date-time
          description: The instant the reservation begins (ISO 8601 format).
          example: '2025-12-10T19:00:00Z'
        end:
          type: string
          format: date-time
          description: The instant the reservation ends (ISO 8601 format).
          example: '2025-12-10T21:00:00Z'
        numberOfGuests:
          type: integer
          format: int32
          minimum: 1
          description: The number of guests expected for the reservation.
          example: 10

    # --- Availability Schemas ---
    RoomAvailability:
      type: object
      description: Details regarding the available booking times for a specific private dining room.
      required:
        - room
        - timesAvailable
      properties:
        room:
          $ref: '#/components/schemas/Reference'
          description: A reference to the room being checked.
        timesAvailable:
          type: array
          description: A list of specific start times (Instant) when the room is available for booking based on the query period.
          items:
            type: string
            format: date-time
            example: '2025-12-12T19:00:00Z'

    RestaurantAvailability:
      type: object
      description: The current availability status for all rooms within a restaurant, showing specific time slots.
      required:
        - restaurant
        - roomAvailabilities
      properties:
        restaurant:
          $ref: '#/components/schemas/Reference'
          description: A reference to the restaurant being queried.
        roomAvailabilities:
          type: array
          description: A list of availability details, showing bookable times for each room within the restaurant.
          items:
            $ref: '#/components/schemas/RoomAvailability'
